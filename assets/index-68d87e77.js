import{a as me,b as he,d as Be,c as we,m as K,p as Te,g as Ee,e as He,f as De,u as Ve,h as ve,l as X,i as Ue,j as je,n as Fe}from"./index-0ad4123e.js";import{d as $,Q as x,R as z,S as r,$ as oe,e as D,r as M,X as n,k as _e,z as pe,V as a,H as v,c as H,Y as A,a4 as te,U as J,l as Ne,W as ne,w as Ke,a5 as Z,a6 as fe}from"./vue-ed5b065f.js";import{s as Pe}from"./media-71897302.js";import{_ as Ie}from"./HistoryContent.vue_vue_type_script_setup_true_lang-ba1b93a9.js";import{C as ge,D as Oe,h as Y,N as Q,j as qe,k as Ge,b as We,m as Je,n as Qe,E as Xe,F as Ye,o as Ze,G as et,H as tt,I as W,J as nt,K as ot,L as st,M as lt,t as at}from"./naive_ui-22e043f0.js";import{g as rt}from"./status-a2702a11.js";import"./OpenaiWebPluginDetailCard.vue_vue_type_script_setup_true_lang-8a4cfd96.js";import"./Close-a90130da.js";const it={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ct=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),ut=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1),dt=[ct,ut],vt=$({name:"Add",render:function(i,s){return x(),z("svg",it,dt)}}),_t={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},pt=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 268l144 144l144-144"},null,-1),ft=r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 392V100"},null,-1),mt=[pt,ft],ht=$({name:"ArrowDown",render:function(i,s){return x(),z("svg",_t,mt)}}),wt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},gt=r("path",{d:"M408 48H104a72.08 72.08 0 0 0-72 72v192a72.08 72.08 0 0 0 72 72h24v64a16 16 0 0 0 26.25 12.29L245.74 384H408a72.08 72.08 0 0 0 72-72V120a72.08 72.08 0 0 0-72-72zM160 248a32 32 0 1 1 32-32a32 32 0 0 1-32 32zm96 0a32 32 0 1 1 32-32a32 32 0 0 1-32 32zm96 0a32 32 0 1 1 32-32a32 32 0 0 1-32 32z",fill:"currentColor"},null,-1),xt=[gt],yt=$({name:"ChatboxEllipses",render:function(i,s){return x(),z("svg",wt,xt)}}),Ct={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},bt=r("path",{d:"M475 64H37C16.58 64 0 81.38 0 102.77v306.42C0 430.59 16.58 448 37 448h438c20.38 0 37-17.41 37-38.81V102.77C512 81.38 495.42 64 475 64zM288 368h-64V256l-48 64l-48-64v112H64V144h64l48 80l48-80h64zm96 0l-80-112h48.05L352 144h64v112h48z",fill:"currentColor"},null,-1),kt=[bt],$t=$({name:"LogoMarkdown",render:function(i,s){return x(),z("svg",Ct,kt)}}),St={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Mt=r("path",{d:"M408 112H106a58 58 0 0 0-58 58v158a56 56 0 0 0 56 56h8v39.68A40.32 40.32 0 0 0 152.32 464h207.36A40.32 40.32 0 0 0 400 423.68V384h8a56 56 0 0 0 56-56V168a56 56 0 0 0-56-56zm-40 311.68a8.35 8.35 0 0 1-8.32 8.32H152.32a8.35 8.35 0 0 1-8.32-8.32V264.32a8.35 8.35 0 0 1 8.32-8.32h207.36a8.35 8.35 0 0 1 8.32 8.32zm26-215.76a24 24 0 1 1 22-22a24 24 0 0 1-22 22z",fill:"currentColor"},null,-1),zt=r("path",{d:"M344 48H168a56.09 56.09 0 0 0-55.42 48h286.84A56.09 56.09 0 0 0 344 48z",fill:"currentColor"},null,-1),Rt=[Mt,zt],Lt=$({name:"Print",render:function(i,s){return x(),z("svg",St,Rt)}}),At={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Bt=r("path",{d:"M476.59 227.05l-.16-.07L49.35 49.84A23.56 23.56 0 0 0 27.14 52A24.65 24.65 0 0 0 16 72.59v113.29a24 24 0 0 0 19.52 23.57l232.93 43.07a4 4 0 0 1 0 7.86L35.53 303.45A24 24 0 0 0 16 327v113.31A23.57 23.57 0 0 0 26.59 460a23.94 23.94 0 0 0 13.22 4a24.55 24.55 0 0 0 9.52-1.93L476.4 285.94l.19-.09a32 32 0 0 0 0-58.8z",fill:"currentColor"},null,-1),Tt=[Bt],Et=$({name:"Send",render:function(i,s){return x(),z("svg",At,Tt)}}),Ht={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Dt=r("path",{d:"M392 432H120a40 40 0 0 1-40-40V120a40 40 0 0 1 40-40h272a40 40 0 0 1 40 40v272a40 40 0 0 1-40 40z",fill:"currentColor"},null,-1),Vt=[Dt],Ut=$({name:"Stop",render:function(i,s){return x(),z("svg",Ht,Vt)}}),jt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ft=r("path",{d:"M20.08 11.42l-4.04-5.65c-.34-.48-.89-.77-1.48-.77c-1.49 0-2.35 1.68-1.49 2.89L16 12l-2.93 4.11c-.87 1.21 0 2.89 1.49 2.89c.59 0 1.15-.29 1.49-.77l4.04-5.65c.24-.35.24-.81-.01-1.16z",fill:"currentColor"},null,-1),Nt=r("path",{d:"M13.08 11.42L9.05 5.77C8.7 5.29 8.15 5 7.56 5C6.07 5 5.2 6.68 6.07 7.89L9 12l-2.93 4.11C5.2 17.32 6.07 19 7.56 19c.59 0 1.15-.29 1.49-.77l4.04-5.65c.24-.35.24-.81-.01-1.16z",fill:"currentColor"},null,-1),Kt=[Ft,Nt],Pt=$({name:"DoubleArrowRound",render:function(i,s){return x(),z("svg",jt,Kt)}}),It={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ot=r("path",{d:"M9.31 17l2.44-2.44L14.19 17l1.06-1.06l-2.44-2.44l2.44-2.44L14.19 10l-2.44 2.44L9.31 10l-1.06 1.06l2.44 2.44l-2.44 2.44L9.31 17zM19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z",fill:"currentColor"},null,-1),qt=[Ot],Gt=$({name:"EventBusyFilled",render:function(i,s){return x(),z("svg",It,qt)}}),Wt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Jt=r("path",{d:"M6 14c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1H7v-2c0-.55-.45-1-1-1zm0-4c.55 0 1-.45 1-1V7h2c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm11 7h-2c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v2zM14 6c0 .55.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1V6c0-.55-.45-1-1-1h-3c-.55 0-1 .45-1 1z",fill:"currentColor"},null,-1),Qt=[Jt],Xt=$({name:"FullscreenRound",render:function(i,s){return x(),z("svg",Wt,Qt)}}),Yt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Zt=r("path",{d:"M17.29 5.71a.996.996 0 0 0-1.41 0L12 9.58L8.11 5.7A.996.996 0 1 0 6.7 7.11l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59a.984.984 0 0 0 0-1.4z",fill:"currentColor"},null,-1),en=r("path",{d:"M17.29 12.3a.996.996 0 0 0-1.41 0L12 16.17l-3.88-3.88a.996.996 0 1 0-1.41 1.41l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59a.993.993 0 0 0-.01-1.4z",fill:"currentColor"},null,-1),tn=[Zt,en],nn=$({name:"KeyboardDoubleArrowDownRound",render:function(i,s){return x(),z("svg",Yt,tn)}}),on={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},sn=r("path",{d:"M6.7 18.29c.39.39 1.02.39 1.41 0L12 14.42l3.88 3.88a.996.996 0 1 0 1.41-1.41L12.7 12.3a.996.996 0 0 0-1.41 0L6.7 16.88a.996.996 0 0 0 0 1.41z",fill:"currentColor"},null,-1),ln=r("path",{d:"M6.7 11.7c.39.39 1.02.39 1.41 0L12 7.83l3.88 3.88a.996.996 0 1 0 1.41-1.41L12.7 5.71a.996.996 0 0 0-1.41 0L6.7 10.29a.996.996 0 0 0 0 1.41z",fill:"currentColor"},null,-1),an=[sn,ln],rn=$({name:"KeyboardDoubleArrowUpRound",render:function(i,s){return x(),z("svg",on,an)}}),cn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},un=r("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z",fill:"currentColor"},null,-1),dn=[un],vn=$({name:"QueueFilled",render:function(i,s){return x(),z("svg",cn,dn)}}),_n={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512","enable-background":"new 0 0 512 512","xml:space":"preserve"},pn=r("path",{d:`M337.454,232c33.599,0,61.092-27.002,61.092-60c0-32.997-27.493-60-61.092-60s-61.09,27.003-61.09,60\r
	C276.364,204.998,303.855,232,337.454,232z M174.546,232c33.599,0,61.09-27.002,61.09-60c0-32.997-27.491-60-61.09-60\r
	s-61.092,27.003-61.092,60C113.454,204.998,140.947,232,174.546,232z M174.546,276C126.688,276,32,298.998,32,346v54h288v-54\r
	C320,298.998,222.401,276,174.546,276z M337.454,287.003c-6.105,0-10.325,0-17.454,0.997c23.426,17.002,32,28,32,58v54h128v-54\r
	C480,298.998,385.312,287.003,337.454,287.003z`},null,-1),fn=[pn],ee=$({name:"MdPeople",render:function(i,s){return x(),z("svg",_n,fn)}}),mn={class:"flex w-full justify-center absolute -top-10"},hn={class:"flex w-full justify-center absolute -top-10"},wn={class:"mx-2 flex flex-row space-x-2 py-2 justify-center relative"},gn={class:"mx-4 mb-4 flex flex-row space-x-2"},xn=$({__name:"InputRegion",props:{canAbort:{type:Boolean},canContinue:{type:Boolean},sendDisabled:{type:Boolean},inputValue:{},autoScrolling:{type:Boolean}},emits:["abort-request","continue-generating","send-msg","export-to-markdown-file","export-to-pdf-file","show-fullscreen-history","update:auto-scrolling","update:input-value"],setup(_,{emit:i}){const s=_,w=ge(),y=me(),{t:c}=oe(),m=D({get(){return s.autoScrolling},set(e){i("update:auto-scrolling",e)}}),g=M(!1),d=D(()=>g.value?{height:"30vh"}:{height:"auto",maxHeight:"16vh"}),l=D({get(){return s.inputValue},set(e){i("update:input-value",e)}}),o=()=>{g.value=!g.value},u=e=>{const t=y.preference.sendKey;(t==="Enter"&&e.key==="Enter"&&!e.shiftKey&&!e.ctrlKey&&!e.isComposing||t==="Shift+Enter"&&e.key==="Enter"&&e.shiftKey&&!e.ctrlKey||t==="Ctrl+Enter"&&e.key==="Enter"&&!e.shiftKey&&e.ctrlKey)&&(e.preventDefault(),i("send-msg"))};return(e,t)=>{const B=Oe,k=Y,R=Q,O=qe,h=Ge,S=We;return x(),z("div",{class:"flex flex-col align-middle",style:te({background:v(w).baseColor})},[n(B),r("div",mn,[_e(n(k,{secondary:"",strong:"",type:"error",size:"small",onClick:t[0]||(t[0]=C=>i("abort-request"))},{icon:a(()=>[n(v(Ut))]),default:a(()=>[H(" "+A(v(c)("commons.abortRequest")),1)]),_:1},512),[[pe,e.canAbort]])]),r("div",hn,[_e(n(k,{secondary:"",strong:"",type:"success",size:"small",onClick:t[1]||(t[1]=C=>i("continue-generating"))},{icon:a(()=>[n(v(Pt))]),default:a(()=>[H(" "+A(v(c)("commons.continueGenerating")),1)]),_:1},512),[[pe,e.canContinue]])]),r("div",wn,[n(k,{class:"absolute left-0 top-2",quaternary:"",circle:"",size:"small",onClick:o},{icon:a(()=>[n(R,{component:g.value?v(nn):v(rn)},null,8,["component"])]),_:1}),n(h,null,{trigger:a(()=>[n(O,{value:m.value,"onUpdate:value":t[2]||(t[2]=C=>m.value=C),size:"small",class:"absolute right-2 top-3"},{icon:a(()=>[H(" A ")]),_:1},8,["value"])]),default:a(()=>[H(" "+A(e.$t("tips.autoScrolling")),1)]),_:1}),n(k,{secondary:"",type:"info",size:"small",onClick:t[3]||(t[3]=C=>i("show-fullscreen-history"))},{icon:a(()=>[n(R,{size:22},{default:a(()=>[n(v(Xt))]),_:1})]),_:1}),n(k,{secondary:"",type:"primary",size:"small",onClick:t[4]||(t[4]=C=>i("export-to-markdown-file"))},{icon:a(()=>[n(R,null,{default:a(()=>[n(v($t))]),_:1})]),_:1}),n(k,{secondary:"",type:"warning",size:"small",onClick:t[5]||(t[5]=C=>i("export-to-pdf-file"))},{icon:a(()=>[n(R,null,{default:a(()=>[n(v(Lt))]),_:1})]),_:1})]),r("div",gn,[n(S,{ref:"inputRef",value:l.value,"onUpdate:value":t[7]||(t[7]=C=>l.value=C),class:"flex-1",type:"textarea",bordered:!0,placeholder:e.$t("tips.sendMessage",[v(y).preference.sendKey]),autosize:{minRows:1},style:te(d.value),onKeydown:u},{suffix:a(()=>[n(k,{disabled:e.sendDisabled,text:"",class:"",type:"primary",size:"small",onClick:t[6]||(t[6]=C=>i("send-msg"))},{icon:a(()=>[n(R,null,{default:a(()=>[n(v(Et))]),_:1})]),_:1},8,["disabled"])]),_:1},8,["value","placeholder","style"])])],4)}}});const yn={class:"flex flex-row justify-between content-center"},Cn={class:"flex flex-row justify-between content-center"},bn={class:"flex flex-row justify-between content-center"},kn={class:"flex flex-row justify-between content-center"},$n={class:"flex flex-row justify-between content-center"},Sn=$({__name:"StatusCard",setup(_){const i=M({}),s=M(!1),w=c=>{c.length>0?(s.value=!0,y()):s.value=!1},y=()=>{s.value&&rt().then(c=>{i.value=c.data})};return y(),setInterval(y,5e3),(c,m)=>{const g=Q,d=Je,l=Qe,o=Xe,u=Ye,e=Ze;return x(),J(e,{"content-style":"padding: 0;"},{default:a(()=>[n(u,{"onUpdate:expandedNames":w},{default:a(()=>[n(o,{title:c.$t("commons.serverStatus"),name:"serverStatus"},{default:a(()=>[n(l,{hoverable:"","show-divider":""},{default:a(()=>[n(d,null,{default:a(()=>[r("div",yn,[r("div",null,[n(g,{class:"mr-1"},{default:a(()=>[n(v(ee))]),_:1}),H(A(c.$t("commons.activeUserIn5m")),1)]),r("div",null,A(i.value.active_user_in_5m),1)])]),_:1}),n(d,null,{default:a(()=>[r("div",Cn,[r("div",null,[n(g,{class:"mr-1"},{default:a(()=>[n(v(ee))]),_:1}),H(A(c.$t("commons.activeUserIn1h")),1)]),r("div",null,A(i.value.active_user_in_1h),1)])]),_:1}),n(d,null,{default:a(()=>[r("div",bn,[r("div",null,[n(g,{class:"mr-1"},{default:a(()=>[n(v(ee))]),_:1}),H(A(c.$t("commons.activeUserIn1d")),1)]),r("div",null,A(i.value.active_user_in_1d),1)])]),_:1}),n(d,null,{default:a(()=>[r("div",kn,[r("div",null,[n(g,{class:"mr-1"},{default:a(()=>[n(v(Gt))]),_:1}),H(A(c.$t("commons.isChatbotBusy")),1)]),r("div",null,A(i.value.is_chatbot_busy?c.$t("commons.yes"):c.$t("commons.no")),1)])]),_:1}),n(d,null,{default:a(()=>[r("div",$n,[r("div",null,[n(g,{class:"mr-1"},{default:a(()=>[n(v(vn))]),_:1}),H(A(c.$t("commons.chatbotWaitingCount")),1)]),r("div",null,A(i.value.chatbot_waiting_count),1)])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})]),_:1})}}});const Mn={class:"h-full flex flex-col"},zn=$({__name:"LeftBar",props:{loading:{type:Boolean},value:{}},emits:["update:value","new-conversation"],setup(_,{emit:i}){const s=_,{t:w}=oe(),y=he(),c=D({get(){return s.value},set(o){i("update:value",o)}}),m=D(()=>!!y.newConversation),g=D(()=>{var e;const o=(e=y.conversations)==null?void 0:e.slice().sort((t,B)=>{if(!t.create_time)return-1;if(!B.create_time)return 1;const k=new Date(t.create_time);return new Date(B.create_time).getTime()-k.getTime()}),u=o==null?void 0:o.map(t=>({label:()=>Ne(et,null,{default:()=>t.title}),key:t.conversation_id,disabled:s.loading==!0,extra:()=>Be(t,d,l)}));return u&&y.newConversation&&u.unshift({label:()=>{var t;return((t=y.newConversation)==null?void 0:t.title)||""},key:y.newConversation.conversation_id,disabled:s.loading==!0}),u}),d=o=>{if(!o)return;const u=we.info({title:w("commons.confirmDialogTitle"),content:w("tips.deleteConversation"),positiveText:w("commons.confirm"),negativeText:w("commons.cancel"),onPositiveClick:()=>(u.loading=!0,new Promise(e=>{y.deleteConversation(o).then(()=>{K.success(w("tips.deleteConversationSuccess")),c.value==o&&(c.value=null)}).catch(()=>{K.error(w("tips.deleteConversationFailed"))}).finally(()=>{u.loading=!1,e(!0)})}))})},l=o=>{o&&Te(o,async u=>{await y.changeConversationTitle(o,u)},()=>{K.success(w("tips.changeConversationTitleSuccess"))},()=>{K.error(w("tips.changeConversationTitleFailed"))})};return(o,u)=>{const e=Q,t=Y,B=tt;return x(),z("div",null,[n(Sn),r("div",Mn,[m.value?ne("",!0):(x(),J(t,{key:0,class:"mb-2",secondary:"",strong:"",type:"primary",disabled:s.loading,onClick:u[0]||(u[0]=k=>i("new-conversation"))},{icon:a(()=>[n(e,{class:""},{default:a(()=>[n(v(vt))]),_:1})]),default:a(()=>[H(" "+A(o.$t("commons.newConversation")),1)]),_:1},8,["disabled"])),n(B,{ref:"menuRef",value:c.value,"onUpdate:value":u[1]||(u[1]=k=>c.value=k),class:"-mx-2","content-style":{backgroundColor:"red"},disabled:s.loading,options:g.value,"root-indent":18},null,8,["value","disabled","options"])])])}}});var xe={exports:{}};(function(_,i){(function(s,w){w()})(W,function(){function s(l,o){return typeof o>"u"?o={autoBom:!1}:typeof o!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function w(l,o,u){var e=new XMLHttpRequest;e.open("GET",l),e.responseType="blob",e.onload=function(){d(e.response,o,u)},e.onerror=function(){console.error("could not download file")},e.send()}function y(l){var o=new XMLHttpRequest;o.open("HEAD",l,!1);try{o.send()}catch{}return 200<=o.status&&299>=o.status}function c(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(o)}}var m=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof W=="object"&&W.global===W?W:void 0,g=m.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=m.saveAs||(typeof window!="object"||window!==m?function(){}:"download"in HTMLAnchorElement.prototype&&!g?function(l,o,u){var e=m.URL||m.webkitURL,t=document.createElement("a");o=o||l.name||"download",t.download=o,t.rel="noopener",typeof l=="string"?(t.href=l,t.origin===location.origin?c(t):y(t.href)?w(l,o,u):c(t,t.target="_blank")):(t.href=e.createObjectURL(l),setTimeout(function(){e.revokeObjectURL(t.href)},4e4),setTimeout(function(){c(t)},0))}:"msSaveOrOpenBlob"in navigator?function(l,o,u){if(o=o||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(s(l,u),o);else if(y(l))w(l,o,u);else{var e=document.createElement("a");e.href=l,e.target="_blank",setTimeout(function(){c(e)})}}:function(l,o,u,e){if(e=e||open("","_blank"),e&&(e.document.title=e.document.body.innerText="downloading..."),typeof l=="string")return w(l,o,u);var t=l.type==="application/octet-stream",B=/constructor/i.test(m.HTMLElement)||m.safari,k=/CriOS\/[\d]+/.test(navigator.userAgent);if((k||t&&B||g)&&typeof FileReader<"u"){var R=new FileReader;R.onloadend=function(){var S=R.result;S=k?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),e?e.location.href=S:location=S,e=null},R.readAsDataURL(l)}else{var O=m.URL||m.webkitURL,h=O.createObjectURL(l);e?e.location=h:location.href=h,e=null,setTimeout(function(){O.revokeObjectURL(h)},4e4)}});m.saveAs=d.saveAs=d,_.exports=d})})(xe);var Rn=xe.exports;const Ln=_=>{const i=Ee(_);let s=`# ${_.title}

`;const w=new Date(_.create_time?_.create_time+"Z":new Date).toLocaleString();s+=`Date: ${w}
Model: ${He(_.current_model||null)}
`,s+=`generated by [ChatGPT Web Share](https://github.com/moeakwak/chatgpt-web-share)

`,s+=`---

`;let y=0;for(const m of i)if(m.role==="user"){let g=De(m).trim().split(`
`)[0];g.length>=50&&(g=g.slice(0,47)+"..."),s+=`## ${++y}. ${g}

`,s+=`### User

${m.content}

`}else s+=`### ChatGPT

${m.content}

`,s+=`---

`;const c=new Blob([s],{type:"text/plain;charset=utf-8"});Rn.saveAs(c,`${_.title} - ChatGPT history.md`)},An={class:"h-full relative flex flex-col"},Bn={class:"right-3 bottom-3 absolute z-20"},Tn=r("div",{class:"h-14"},null,-1),Kn=$({__name:"index",setup(_){const i=ge(),{t:s}=oe(),w=Pe("md"),y=M(),c=M(),m=Ve(),g=me(),d=he(),l=M(!1),o=M(!1),u=ve("autoScrolling",!0),e=M(!1),t=M(!1),B=M(!1),k=ve("foldLeftBar",!1);let R=null;const O=M(!1),h=M(null),S=D(()=>{var f,E;return h.value===((f=d.newConversation)==null?void 0:f.conversation_id)?d.newConversation:((E=d.conversations)==null?void 0:E.find(j=>j.conversation_id==h.value))||null}),C=D(()=>h.value&&d.conversationHistoryMap[h.value]||null),P=M(""),V=M(null),T=M([]),ye=D(()=>{const p=[];V.value&&p.push(V.value);for(const f of T.value)p.push(f);return p});Ke(h,(p,f)=>{p!="new_conversation"&&Ce(p)});const Ce=p=>{l.value||!p||(l.value=!0,o.value=!0,X.start(),d.fetchConversationHistory(p).then(()=>{}).catch(f=>{console.log(f)}).finally(()=>{l.value=!1,o.value=!1,X.finish()}))},se=D(()=>l.value||h.value==null||P.value===null||P.value.trim()==""),le=()=>{O.value||Ue(async p=>{console.log("makeNewConversation",p),!(!p.source||!p.model)&&(p.title=p.title||`New Chat (${s("sources_short."+p.source)})`,d.createNewConversation(p),h.value=d.newConversation.conversation_id)})},be=()=>{R==null||!t.value||(R(),R=null)},ke=()=>{P.value=":continue",re()},$e=()=>{c.value.scrollTo({left:0,top:c.value.$refs.scrollbarInstRef.contentRef.scrollHeight})},Se=()=>{c.value.scrollTo({left:0,top:c.value.$refs.scrollbarInstRef.contentRef.scrollHeight,behavior:"smooth"})};function ae(p,f,E,j){return{id:`temp_${Math.random().toString(36).substring(2,16)}`,source:S.value.source,content:f,role:p,parent:E,children:[],model:j}}const re=async()=>{var ie,ce,ue;if(se.value||l.value||C.value==null){K.error(s("tips.pleaseSelectConversation"));return}X.start(),l.value=!0,B.value=!1;const p=P.value;P.value="",t.value=!1,e.value=!1;let f=!1;const E={source:S.value.source,new_conversation:h.value.startsWith("new_conversation"),model:S.value.current_model,content:p,openai_web_plugin_ids:((ie=C.value.metadata)==null?void 0:ie.source)==="openai_web"?(ce=C.value.metadata)==null?void 0:ce.plugin_ids:void 0};d.newConversation?E.new_title=d.newConversation.title:(E.conversation_id=h.value,E.parent=C.value.current_node),p==":continue"?(V.value=null,T.value=[]):(V.value=ae("user",p,(ue=C.value)==null?void 0:ue.current_node,S.value.current_model),T.value=[ae("assistant","...",V.value.id,S.value.current_model)]);const j=je();let G=!1,I=null;console.log("Connecting to",j,E);const F=new WebSocket(j);let L=null;F.onopen=U=>{F.send(JSON.stringify(E))},F.onmessage=U=>{const b=JSON.parse(U.data);if(b.type==="waiting")t.value=!1,T.value[0].content=s(b.tip||"tips.waiting");else if(b.type==="queueing")t.value=!0,T.value[0].content=s(b.tip||"tips.queueing");else if(b.type==="message"){f||(T.value=[],f=!0);const N=b.message;if(N.role!=="user"){const de=T.value.findIndex(Ae=>Ae.id===N.id);de===-1?T.value.push(N):T.value[de]=N}L=b.conversation_id||null,t.value=!0}else b.type==="error"&&(G=!0,console.error("websocket received error message",b),I=b);u.value&&$e()},F.onclose=async U=>{if(R=null,t.value=!1,console.log("WebSocket connection is closed",U,e.value),!G&&(U.code==1e3||e.value)){if(f){let b=[];V.value&&(b=[V.value]);for(const N of T.value)b.push(N);if(h.value==Fe){const N={_id:L,source:"openai_web",title:C.value.title,current_model:C.value.current_model,create_time:C.value.create_time,update_time:C.value.update_time,metadata:C.value.metadata,mapping:{},current_node:""};d.$patch({conversationHistoryMap:{[L]:N}})}d.addMessagesToConversation(L,b),V.value=null,T.value=[],h.value=L,await d.fetchAllConversations(),d.removeNewConversation(),console.log("done",b,h.value)}}else{let b="";I!=null?I.tip?b=s(I.tip):b=I.error_detail||s("errors.unknown"):b=`WebSocket ${U.code}: ${s(U.reason||"errors.unknown")}`,we.error({title:s("errors.askError"),content:b,positiveText:s("commons.withdrawMessage"),negativeText:s("commons.cancel"),onPositiveClick:()=>{V.value=null,T.value=[]}})}await m.fetchUserInfo(),X.finish(),l.value=!1,e.value=!1},F.onerror=U=>{console.error("WebSocket error:",U)},R=()=>{e.value=!0,F.close()}},Me=()=>{if(!S.value){K.error(s("tips.pleaseSelectConversation"));return}Ln(C.value)},q=M(),ze=M(!1),Re=()=>{if(!S.value){K.error(s("tips.pleaseSelectConversation"));return}q.value.focus(),q.value.toggleFullscreenHistory(!0)},Le=()=>{if(!S.value){K.error(s("tips.pleaseSelectConversation"));return}q.value.toggleFullscreenHistory(!1),window.print(),q.value.toggleFullscreenHistory(!1)};return d.fetchAllConversations().then(),(p,f)=>{const E=nt,j=ot,G=st,I=lt,F=at;return x(),J(F,{ref_key:"rootRef",ref:y,"has-sider":"",class:Z(["h-full",v(g).preference.widerConversationPage?"":"lg:w-screen-lg lg:mx-auto"])},{default:a(()=>[n(E,{collapsed:v(k),"onUpdate:collapsed":f[1]||(f[1]=L=>fe(k)?k.value=L:null),"native-scrollbar":!1,"collapsed-width":0,"collapse-mode":"transform","trigger-style":"top: 27px; right: -26px;","collapsed-trigger-style":"top: 27px; right: -26px;",bordered:"","show-trigger":"arrow-circle",width:260,class:"h-full"},{default:a(()=>[n(zn,{value:h.value,"onUpdate:value":f[0]||(f[0]=L=>h.value=L),class:Z(["h-full pt-4 px-4 box-border mb-4 overflow-hidden flex flex-col space-y-4"]),loading:l.value,onNewConversation:le},null,8,["value","loading"])]),_:1},8,["collapsed"]),n(I,{embeded:"",class:Z(["flex flex-col overflow-hidden",v(w)()?"":"min-w-100vw"])},{default:a(()=>[r("div",An,[h.value?(x(),J(j,{key:0,ref_key:"historyRef",ref:c,class:"relative","content-style":o.value?{height:"100%"}:{}},{default:a(()=>[r("div",Bn,[n(v(Y),{secondary:"",circle:"",size:"small",onClick:Se},{icon:a(()=>[n(v(Q),{component:v(ht)},null,8,["component"])]),_:1})]),n(Ie,{ref_key:"historyContentRef",ref:q,"can-continue":B.value,"onUpdate:canContinue":f[2]||(f[2]=L=>B.value=L),"conversation-id":h.value,"extra-messages":ye.value,fullscreen:!1,"show-tips":ze.value,loading:o.value},null,8,["can-continue","conversation-id","extra-messages","show-tips","loading"]),Tn]),_:1},8,["content-style"])):h.value?ne("",!0):(x(),z("div",{key:1,class:"flex-grow flex flex-col justify-center",style:te({backgroundColor:v(i).cardColor})},[S.value?ne("",!0):(x(),J(G,{key:0,description:p.$t("tips.loadConversation")},{icon:a(()=>[n(v(Q),null,{default:a(()=>[n(v(yt))]),_:1})]),extra:a(()=>[n(v(Y),{onClick:le},{default:a(()=>[H(A(p.$t("tips.newConversation")),1)]),_:1})]),_:1},8,["description"]))],4)),n(xn,{"input-value":P.value,"onUpdate:inputValue":f[3]||(f[3]=L=>P.value=L),"auto-scrolling":v(u),"onUpdate:autoScrolling":f[4]||(f[4]=L=>fe(u)?u.value=L:null),class:"sticky bottom-0 z-10","can-abort":t.value,"can-continue":B.value,"send-disabled":se.value,onAbortRequest:be,onContinueGenerating:ke,onExportToMarkdownFile:Me,onExportToPdfFile:Le,onSendMsg:re,onShowFullscreenHistory:Re},null,8,["input-value","auto-scrolling","can-abort","can-continue","send-disabled"])])]),_:1},8,["class"])]),_:1},8,["class"])}}});export{Kn as default};
//# sourceMappingURL=index-68d87e77.js.map
