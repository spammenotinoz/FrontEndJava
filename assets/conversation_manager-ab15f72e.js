import{d as $,Q as S,R as F,S as h,r as A,e as B,U as D,H as a,$ as R,a2 as M,l as x,X as s,V as r,k as H,z as K,c as g,Y as C}from"./vue-ed5b065f.js";import{x as E,v as O,e as j,K as L,c as w,m as d,L as Q,M as W,N,O as X}from"./index-0ad4123e.js";import{g as Y,T as Z}from"./table-3ad8c54c.js";import{Z as q,k as z,h as _,W as G,N as T}from"./naive_ui-22e043f0.js";import{R as J}from"./RefreshFilled-909ab4ff.js";const ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},oe=h("path",{d:"M14 9l-1-2H7V5.72c.6-.34 1-.98 1-1.72c0-1.1-.9-2-2-2s-2 .9-2 2c0 .74.4 1.38 1 1.72V21h2v-4h5l1 2h7V9h-6zm4 8h-4l-1-2H7V9h5l1 2h5v6z",fill:"currentColor"},null,-1),te=[oe],ne=$({name:"EmojiFlagsFilled",render:function(o,f){return S(),F("svg",ee,te)}}),se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ae=h("path",{d:"M13 8c0-2.21-1.79-4-4-4S5 5.79 5 8s1.79 4 4 4s4-1.79 4-4zm2 2v2h3v3h2v-3h3v-2h-3V7h-2v3h-3zM1 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4z",fill:"currentColor"},null,-1),ie=[ae],re=$({name:"PersonAddAlt1Filled",render:function(o,f){return S(),F("svg",se,ie)}}),le=$({__name:"UserSelector",emits:["update:value"],setup(P,{emit:o}){const f=E.global.t,v=A([]),y=A(null),l=u=>!0,m=u=>{o("update:value",u)};O().then(u=>{v.value=u.data});const U=B(()=>v.value.map(u=>({label:u.username,value:u.username})));return(u,k)=>{const V=q;return S(),D(V,{value:y.value,"onUpdate:value":[k[0]||(k[0]=b=>y.value=b),m],"get-show":l,options:U.value,placeholder:a(f)("commons.chooseUser")},null,8,["value","options","placeholder"])}}}),ce={class:"mb-4 mt-1 ml-1 flex flex-row justify-between space-x-2"},de={class:"flex flex-row space-x-4"},ue={class:"space-x-2"},me={class:"space-x-2"},ge=$({__name:"conversation_manager",setup(P){const{t:o}=R(),f=M(),v=A([]),y=e=>e.conversation_id,l=A([]),m=()=>{L(!1).then(e=>{v.value=e.data})};m();const U=[{type:"selection"},{title:"#",key:"id",sorter:"default"},{title:"UUID",key:"conversation_id",render:e=>x(z,{trigger:"hover"},{trigger:()=>{var n;return(n=e.conversation_id)==null?void 0:n.substring(0,4)},default:()=>e.conversation_id})},{title:o("labels.source"),key:"type",render:e=>o(`sources_short.${e.source}`)},{title:o("commons.title"),key:"title",sorter:"default",render:e=>x(_,{text:!0,tag:"a",href:f.resolve({name:"conversationHistory",params:{conversation_id:e.conversation_id}}).href,target:"_blank"},{default:()=>e.title?e.title:o("commons.empty")})},{title:o("commons.belongToUser"),key:"user_id",render:e=>e.user_id?e.user_id:o("commons.empty"),sorter:"default"},{title:o("commons.createTime"),key:"create_time",defaultSortOrder:"descend",sorter:Y("create_time"),render:e=>e.create_time?x(z,{trigger:"hover"},{trigger:()=>new Date(e.create_time).toLocaleString(),default:()=>e.create_time}):""},{title:o("commons.modelName"),key:"current_model",render(e){return e.current_model?j(e.current_model):o("commons.unknown")},sorter:"default"},{title:o("commons.isValid"),key:"is_valid",render(e){return e.is_valid?o("commons.yes"):o("commons.no")},sorter:(e,n)=>{const t=e.is_valid?1:0,i=n.is_valid?1:0;return t-i}}],u=()=>{const e=w.info({title:o("commons.invalidateConversation"),content:o("tips.invalidateConversation"),positiveText:o("commons.confirm"),negativeText:o("commons.cancel"),onPositiveClick:()=>(e.loading=!0,new Promise((n,t)=>{(async()=>{for(const c of l.value)await W(c)})().then(()=>{d.success(o("tips.deleteConversationSuccess")),m(),n(!0)}).catch(c=>{d.error(o("tips.deleteConversationFailed")+": "+c),t(c)}).finally(()=>{e.loading=!1})}))})},k=()=>{const e=w.warning({title:o("commons.vanishConversation"),content:o("tips.vanishConversation"),positiveText:o("commons.confirm"),negativeText:o("commons.cancel"),onPositiveClick:()=>(e.loading=!0,new Promise((n,t)=>{(async()=>{for(const c of l.value)await N(c),await new Promise(p=>setTimeout(p,200))})().then(()=>{d.success(o("tips.success")),m(),l.value=[],n(!0)}).catch(c=>{d.error(o("tips.failed")+": "+c),t(c)}).finally(()=>{e.loading=!1})}))})},V=()=>{let e=null;const n=w.warning({title:o("commons.chooseUserToAssign"),content:()=>x(le,{"onUpdate:value":t=>{e=t}}),positiveText:o("commons.confirm"),negativeText:o("commons.cancel"),onPositiveClick:()=>(n.loading=!0,new Promise((t,i)=>{if(e===null){d.error(o("errors.noUserSelected")),n.loading=!1,i(!1);return}(async()=>{for(const p of l.value)await X(p,e)})().then(()=>{d.success(o("tips.success")),m(),l.value=[],t(!0)}).catch(p=>{d.error(o("tips.failed")+": "+p),i(p)}).finally(()=>{n.loading=!1})}))})},b=()=>{const e=w.info({title:o("commons.deleteInvalidConversations"),content:o("commons.deleteInvalidConversationsConfirm"),positiveText:o("commons.confirm"),negativeText:o("commons.cancel"),onPositiveClick:()=>{e.loading=!0;const n=async()=>{for(const t of v.value)t.is_valid||(await N(t.conversation_id),await new Promise(i=>setTimeout(i,200)));v.value=v.value.filter(t=>t.is_valid)};return new Promise((t,i)=>{n().then(()=>{d.success(o("tips.deleteConversationSuccess")),m(),l.value=[],t(!0)}).catch(c=>{console.error(c),d.error(o("tips.deleteConversationFailed")),i()}).finally(()=>{e.loading=!1})})}})},I=()=>{const e=w.error({title:o("commons.clearAllConversations"),content:o("commons.readyToClearAllConversations"),positiveText:o("commons.confirm"),negativeText:o("commons.cancel"),onPositiveClick:()=>(e.loading=!0,new Promise((n,t)=>{Q().then(()=>{d.success(o("tips.deleteConversationSuccess")),m(),l.value=[],n(!0)}).catch(i=>{console.error(i),d.error(o("tips.deleteConversationFailed")),t()}).finally(()=>{e.loading=!1})}))})};return(e,n)=>{const t=G;return S(),F("div",null,[h("div",ce,[h("div",de,[s(a(_),{circle:"",onClick:m},{icon:r(()=>[s(a(T),null,{default:r(()=>[s(a(J))]),_:1})]),_:1}),H(h("div",ue,[s(a(_),{type:"warning",secondary:"",onClick:u},{icon:r(()=>[s(a(T),null,{default:r(()=>[s(a(ne))]),_:1})]),default:r(()=>[g(" "+C(e.$t("commons.invalidateConversation")),1)]),_:1}),s(a(_),{type:"error",secondary:"",onClick:k},{icon:r(()=>[s(a(T),null,{default:r(()=>[s(a(Z))]),_:1})]),default:r(()=>[g(" "+C(e.$t("commons.vanishConversation")),1)]),_:1}),s(a(_),{type:"info",secondary:"",onClick:V},{icon:r(()=>[s(a(T),null,{default:r(()=>[s(a(re))]),_:1})]),default:r(()=>[g(" "+C(e.$t("commons.chooseUserToAssign")),1)]),_:1})],512),[[K,l.value.length!==0]])]),h("div",me,[s(a(_),{onClick:b},{default:r(()=>[g(C(e.$t("commons.deleteInvalidConversations")),1)]),_:1}),s(a(_),{type:"error",onClick:I},{default:r(()=>[g(C(e.$t("commons.clearAllConversations")),1)]),_:1})])]),s(t,{"checked-row-keys":l.value,"onUpdate:checkedRowKeys":n[0]||(n[0]=i=>l.value=i),size:"small",columns:U,data:v.value,bordered:!0,pagination:{pageSize:20},"row-key":y},null,8,["checked-row-keys","data"])])}}});export{ge as default};
//# sourceMappingURL=conversation_manager-ab15f72e.js.map
